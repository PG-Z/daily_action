name: Pull Bing Image

on:
#  schedule:
#    - cron: '0 0 * * *'  # 每天凌晨执行
  push:
    branches: [ main ]
jobs:
  pull-bing-image:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v2

      - name: Pull Bing Image
        run: |
          URL="https://www.bing.com/HPImageArchive.aspx?format=js&idx=0&n=1&mkt=en-US"
          IMAGE_PATH="$(curl -s $URL | jq -r '.images[0].url' | sed 's/^/https:\/\/www.bing.com/;s/1366x768.jpg$/1920x1080.jpg/')"
          #FILE_NAME="$(echo $IMAGE_PATH | awk -F '/' '{print $NF}')"
          FILE_NAME="$(date +"%Y%m%d").jpg"
          mkdir -p images
          curl -s $IMAGE_PATH -o "images/$FILE_NAME"
          #复制文件
          cp images/$FILE_NAME images/lastest.jpg

      - name: Commit and push changes
        env:
          GITHUB_TOKEN: ${{ secrets.PAT }}
        run: |
          git config user.name ${{ secrets.NAME }}
          git config user.email ${{ secrets.EMAIL }}
          git add images/*
          git commit -m "Update wallpaper bing image"
          git push
